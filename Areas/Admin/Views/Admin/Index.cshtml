@using WebApplication2.Models
@model WebApplication2.Areas.Admin.Controllers.AdminDashboardViewModel
@{
    ViewData["Title"] = "Панель управління";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<!-- Page Header -->
<div class="page-header">
    <h1>Панель управління</h1>
    <p>Огляд ключових метрик та статистики</p>
</div>

<!-- Statistics Cards -->
<div class="row g-4 mb-4">
    <div class="col-md-6 col-xl-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="mb-2">Товарів</p>
                    <h3>@Model.TotalProducts</h3>
                    <small class="text-muted">
                        @if (Model.LowStockProducts > 0)
                        {
                            <span class="text-warning">
                                <i class="fas fa-exclamation-triangle"></i> @Model.LowStockProducts з низьким залишком
                            </span>
                        }
                        else
                        {
                            <span class="text-success">
                                <i class="fas fa-check"></i> Всі товари в наявності
                            </span>
                        }
                    </small>
                </div>
                <div class="stat-icon" style="background: #dbeafe; color: #1e40af;">
                    <i class="fas fa-box"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="mb-2">Замовлень</p>
                    <h3>@Model.TotalOrders</h3>
                    @if (Model.NewOrders > 0)
                    {
                        <small class="text-danger">
                            <i class="fas fa-bell"></i> @Model.NewOrders нових
                        </small>
                    }
                    else
                    {
                        <small class="text-muted">Немає нових</small>
                    }
                </div>
                <div class="stat-icon" style="background: #fef3c7; color: #92400e;">
                    <i class="fas fa-shopping-cart"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="mb-2">Користувачів</p>
                    <h3>@Model.TotalUsers</h3>
                    <small class="text-muted">Зареєстровано</small>
                </div>
                <div class="stat-icon" style="background: #e0e7ff; color: #3730a3;">
                    <i class="fas fa-users"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <p class="mb-2">Виручка</p>
                    <h3>@Model.TotalRevenue.ToString("N0") ₴</h3>
                    <small class="text-success">
                        <i class="fas fa-arrow-up"></i> Доставлені замовлення
                    </small>
                </div>
                <div class="stat-icon" style="background: #d1fae5; color: #065f46;">
                    <i class="fas fa-dollar-sign"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Alerts -->
@if (Model.NewOrders > 0)
{
    <div class="alert alert-warning mb-4">
        <div class="d-flex align-items-center">
            <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
            <div class="flex-grow-1">
                <strong>Увага!</strong> У вас є @Model.NewOrders нових замовлень, які потребують обробки.
            </div>
            <a href="@Url.Action("Orders", "Admin", new { area = "Admin", status = 0 })" class="btn btn-warning">
                Переглянути
            </a>
        </div>
    </div>
}

@if (Model.LowStockProducts > 0)
{
    <div class="alert alert-info mb-4">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle fa-2x me-3"></i>
            <div class="flex-grow-1">
                <strong>Інформація:</strong> @Model.LowStockProducts товарів з низьким залишком на складі.
            </div>
            <a asp-action="Products" class="btn btn-info">
                Переглянути
            </a>
        </div>
    </div>
}

<!-- Main Content -->
<div class="row g-4">
    <!-- Recent Orders -->
    <div class="col-xl-8">
        <div class="table-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="fas fa-clock"></i> Останні замовлення</h5>
                <a href="/Admin/Admin/Orders" asp-action="Orders" class="btn btn-sm btn-primary">
                    Всі замовлення <i class="fas fa-arrow-right"></i>
                </a>
            </div>

            @if (Model.RecentOrders.Any())
            {
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>№</th>
                                <th>Клієнт</th>
                                <th>Товарів</th>
                                <th>Сума</th>
                                <th>Статус</th>
                                <th>Дата</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var order in Model.RecentOrders)
                            {
                                <tr>
                                    <td><strong>@order.OrderNumber</strong></td>
                                    <td>
                                        <div>@order.CustomerName</div>
                                        <small class="text-muted">@order.CustomerPhone</small>
                                    </td>
                                    <td>@order.OrderItems.Count шт.</td>
                                    <td><strong>@order.TotalAmount.ToString("N0") ₴</strong></td>
                                    <td>
                                        @switch (order.Status)
                                        {
                                            case OrderStatus.New:
                                                <span class="badge badge-new">Нове</span>
                                                break;
                                            case OrderStatus.Processing:
                                                <span class="badge badge-processing">В обробці</span>
                                                break;
                                            case OrderStatus.Shipped:
                                                <span class="badge badge-shipped">Відправлено</span>
                                                break;
                                            case OrderStatus.Delivered:
                                                <span class="badge badge-delivered">Доставлено</span>
                                                break;
                                            case OrderStatus.Cancelled:
                                                <span class="badge badge-cancelled">Скасовано</span>
                                                break;
                                        }
                                    </td>
                                    <td>
                                        <div>@order.CreatedAt.ToString("dd.MM.yyyy")</div>
                                        <small class="text-muted">@order.CreatedAt.ToString("HH:mm")</small>
                                    </td>
                                    <td>
                                        <a href="/Admin/Admin/OrderDetails/@order.Id" asp-route-id="@order.Id" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5 text-muted">
                    <i class="fas fa-inbox fa-3x mb-3"></i>
                    <p>Немає замовлень</p>
                </div>
            }
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-xl-4">
        <!-- Top Products -->
        <div class="table-card mb-4">
            <h5><i class="fas fa-star"></i> Топ товари</h5>
            @if (Model.TopProducts.Any())
            {
                <div class="list-group list-group-flush">
                    @foreach (var product in Model.TopProducts)
                    {
                        <div class="list-group-item px-0 border-0 border-bottom">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">@product.ProductName</h6>
                                    <small class="text-muted">Продано: @product.TotalSold шт.</small>
                                </div>
                                <div class="text-end">
                                    <strong class="text-success">@product.Revenue.ToString("N0") ₴</strong>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p class="text-muted text-center py-3">Немає даних</p>
            }
        </div>

        <!-- Recent Users -->
        <div class="table-card">
            <h5><i class="fas fa-user-plus"></i> Нові користувачі</h5>
            @if (Model.RecentUsers.Any())
            {
                <div class="list-group list-group-flush">
                    @foreach (var user in Model.RecentUsers)
                    {
                        <div class="list-group-item px-0 border-0 border-bottom">
                            <div class="d-flex align-items-center">
                                <div class="flex-shrink-0 me-3">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center" 
                                         style="width: 40px; height: 40px; background: linear-gradient(135deg, #4f46e5, #7c3aed); color: white; font-weight: 600;">
                                        @user.FirstName.Substring(0, 1)@user.LastName.Substring(0, 1)
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-0">@user.FirstName @user.LastName</h6>
                                    <small class="text-muted">@user.CreatedAt.ToString("dd.MM.yyyy")</small>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p class="text-muted text-center py-3">Немає даних</p>
            }
        </div>
    </div>
</div>