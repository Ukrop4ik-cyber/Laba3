@model WebApplication2.ViewModels.CheckoutViewModel
@{

ViewData
[
"Title"
]

=

"Оформлення замовлення"
;

}


<div class="container my-5">
    <h1 class="mb-4"><i class="fas fa-shopping-bag"></i> Оформлення замовлення</h1>

    <div class="row">
        <div class="col-lg-8">
            <form asp-action="Checkout" method="post" id="checkoutForm">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                <!-- Контактні дані -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-user"></i> Контактні дані</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="CustomerName" class="form-label"></label>
                            <input asp-for="CustomerName" class="form-control" placeholder="Прізвище Ім'я По батькові"/>
                            <span asp-validation-for="CustomerName" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerEmail" class="form-label"></label>
                                <input asp-for="CustomerEmail" class="form-control" placeholder="example@mail.com"/>
                                <span asp-validation-for="CustomerEmail" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="CustomerPhone" class="form-label"></label>
                                <input asp-for="CustomerPhone" class="form-control" placeholder="+380 (XX) XXX-XX-XX"/>
                                <span asp-validation-for="CustomerPhone" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Доставка -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-truck"></i> Доставка</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="DeliveryMethod" class="form-label"></label>
                            <select asp-for="DeliveryMethod" class="form-select" id="deliveryMethod">
                                <option value="">Оберіть спосіб доставки...</option>
                                <option value="Самовивіз">Самовивіз з магазину (безкоштовно)</option>
                                <option value="Кур'єр по місту">Кур'єр по місту (150 грн)</option>
                                <option value="Нова Пошта">Нова Пошта (за тарифами)</option>
                                <option value="Укрпошта">Укрпошта (за тарифами)</option>
                            </select>
                            <span asp-validation-for="DeliveryMethod" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="DeliveryAddress" class="form-label"></label>
                            <textarea asp-for="DeliveryAddress" class="form-control" rows="3"
                                      placeholder="Вкажіть повну адресу доставки або відділення"></textarea>
                            <span asp-validation-for="DeliveryAddress" class="text-danger"></span>
                        </div>

                        <div class="alert alert-info">
                            <small>
                                <i class="fas fa-info-circle"></i>
                                <strong>Безкоштовна доставка</strong> при замовленні від 5000 грн
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Оплата -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-warning">
                        <h5 class="mb-0"><i class="fas fa-credit-card"></i> Оплата</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label asp-for="PaymentMethod" class="form-label"></label>
                            <select asp-for="PaymentMethod" class="form-select">
                                <option value="">Оберіть спосіб оплати...</option>
                                <option value="Готівка при отриманні">Готівка при отриманні</option>
                                <option value="Оплата карткою онлайн">Оплата карткою онлайн</option>
                                <option value="Безготівковий розрахунок">Безготівковий розрахунок</option>
                                <option value="Приват24">Приват24</option>
                            </select>
                            <span asp-validation-for="PaymentMethod" class="text-danger"></span>
                        </div>

                        <div class="d-flex gap-2 mb-3">
                            <i class="fab fa-cc-visa fa-3x text-primary"></i>
                            <i class="fab fa-cc-mastercard fa-3x text-warning"></i>
                            <i class="fas fa-money-bill-wave fa-3x text-success"></i>
                        </div>
                    </div>
                </div>

                <!-- Коментар -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <label asp-for="Notes" class="form-label"></label>
                        <textarea asp-for="Notes" class="form-control" rows="3"
                                  placeholder="Додаткові побажання до замовлення (необов'язково)"></textarea>
                    </div>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                    <label class="form-check-label" for="agreeTerms">
                        Я погоджуюсь з <a href="#">умовами обробки персональних даних</a> та
                        <a href="#">правилами користування сайтом</a> *
                    </label>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-check-circle"></i> Підтвердити замовлення
                    </button>
                    <a asp-controller="Cart" asp-action="Index" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> Повернутися до кошика
                    </a>
                </div>
            </form>
        </div>

        <!-- Sidebar з деталями замовлення -->
        <div class="col-lg-4">
            <div class="card shadow-sm sticky-top" style="top: 20px;">
                <div class="card-header bg-light">
                    <h5 class="mb-0">Ваше замовлення</h5>
                </div>
                <div class="card-body" id="orderSummary">
                    <!-- Тут буде завантажено деталі замовлення через AJAX -->
                    <div class="text-center py-3">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Завантаження...</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm mt-3 bg-light">
                <div class="card-body">
                    <h6 class="card-title"><i class="fas fa-shield-alt"></i> Гарантії</h6>
                    <ul class="small mb-0">
                        <li>Повернення протягом 14 днів</li>
                        <li>Офіційна гарантія виробника</li>
                        <li>Безпечна оплата</li>
                        <li>Захист персональних даних</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial"/>
    <script>
        $(document).ready(function () {
            // Завантаження деталей замовлення
            loadOrderSummary();

            // Маска для телефону
            $('#CustomerPhone').on('input', function (e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 0) {
                    if (value.length <= 10) {
                        value = value.replace(/(\d{3})(\d{2})(\d{3})(\d{2})(\d{2})/, '+380 ($2) $3-$4-$5');
                    }
                    e.target.value = value;
                }
            });

            // Зміна способу доставки
            $('#deliveryMethod').on('change', function () {
                const method = $(this).val();
                if (method === 'Самовивіз') {
                    $('#DeliveryAddress').val('м. Хмельницький, вул. Інститутська, 11');
                }
            });
        });

        function loadOrderSummary() {
            setTimeout(function () {
                $('#orderSummary').html(`
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> 
                        Деталі замовлення будуть відображені тут
                    </div>
                `);
            }, 500);
        }
    </script>
}